

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>decogo.pyomo_minlp_model.input_model &mdash; Decogo 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Decogo
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../sources/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sources/example.html">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sources/settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sources/tests.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sources/modules.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sources/classes.html">Class inheritance diagram</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Decogo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>decogo.pyomo_minlp_model.input_model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for decogo.pyomo_minlp_model.input_model</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Implements colgen for pyomo minlp input model &quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pyomo.core.base</span> <span class="kn">import</span> <span class="n">Expression</span>
<span class="kn">from</span> <span class="nn">pyomo.core.expr.visitor</span> <span class="kn">import</span> <span class="n">identify_variables</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="n">ConcreteModel</span><span class="p">,</span> <span class="n">Objective</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Param</span><span class="p">,</span> <span class="n">Block</span>
<span class="kn">from</span> <span class="nn">pyomo.network</span> <span class="kn">import</span> <span class="n">Port</span><span class="p">,</span> <span class="n">Arc</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.constraint</span> <span class="kn">import</span> <span class="n">IndexedConstraint</span><span class="p">,</span> \
    <span class="n">Constraint</span><span class="p">,</span> <span class="n">ScalarConstraint</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.var</span> <span class="kn">import</span> <span class="n">_GeneralVarData</span><span class="p">,</span> <span class="n">Var</span><span class="p">,</span> <span class="n">ScalarVar</span>
<span class="kn">from</span> <span class="nn">pyomo.core.expr.numeric_expr</span> <span class="kn">import</span> <span class="n">NegationExpression</span><span class="p">,</span> \
    <span class="n">MonomialTermExpression</span><span class="p">,</span> <span class="n">ProductExpression</span><span class="p">,</span> <span class="n">SumExpression</span><span class="p">,</span> \
    <span class="n">LinearExpression</span>

<span class="kn">from</span> <span class="nn">decogo.util.block_vector</span> <span class="kn">import</span> <span class="n">BlockVector</span>

<span class="kn">from</span> <span class="nn">decogo.model.constraints</span> <span class="kn">import</span> <span class="n">LinearConstraint</span><span class="p">,</span> <span class="n">ObjectiveFunction</span><span class="p">,</span> \
    <span class="n">VarDomain</span><span class="p">,</span> <span class="n">NonLinearConstraint</span>
<span class="kn">from</span> <span class="nn">decogo.model.model_decomposer</span> <span class="kn">import</span> <span class="n">PyomoModelDecomposer</span>
<span class="kn">from</span> <span class="nn">decogo.model.input_model_base</span> <span class="kn">import</span> <span class="n">InputModelBase</span><span class="p">,</span> <span class="n">OriginalProblemBase</span><span class="p">,</span> \
    <span class="n">CutPoolCG</span><span class="p">,</span> <span class="n">SubProblemsBase</span><span class="p">,</span> <span class="n">SubModelBase</span>

<span class="kn">from</span> <span class="nn">decogo.pyomo_minlp_model.subproblem</span> <span class="kn">import</span> <span class="n">PyomoMinlpSubProblem</span><span class="p">,</span> \
    <span class="n">PyomoLineSearchSubProblem</span><span class="p">,</span> <span class="n">PyomoProjectionSubProblem</span><span class="p">,</span> \
    <span class="n">PyomoResourceProjectionSubProblem</span>
<span class="kn">from</span> <span class="nn">decogo.pyomo_minlp_model.nlp_master_problem</span> <span class="kn">import</span> <span class="n">NlpProblem</span>
<span class="kn">from</span> <span class="nn">decogo.pyomo_minlp_model.projection_master_problem</span> <span class="kn">import</span> \
    <span class="n">NlpResourceProjectionProblem</span><span class="p">,</span> \
    <span class="n">MipProjectionMasterProblem</span>

<span class="kn">from</span> <span class="nn">decogo.solver.settings</span> <span class="kn">import</span> <span class="n">Settings</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;decogo&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="PyomoInputModel"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoInputModel">[docs]</a><span class="k">class</span> <span class="nc">PyomoInputModel</span><span class="p">(</span><span class="n">InputModelBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;User-defined input model for pyomo MINLP problems</span>

<span class="sd">    :param model: Input Pyomo model</span>
<span class="sd">    :type model: ConcreteModel</span>
<span class="sd">    :param blocks: List (blockwise) of original string names of variables</span>
<span class="sd">    :type blocks: list</span>
<span class="sd">    :param block_sizes: List of variable numbers per sub-model</span>
<span class="sd">    :type block_sizes: list</span>
<span class="sd">    :param sense: Indicates the the problem is minimization (1) or  \</span>
<span class="sd">    maximization (-1)</span>
<span class="sd">    :type sense: int</span>
<span class="sd">    :param sub_problems: list of SubProblems blockwise</span>
<span class="sd">    :type sub_problems: list</span>
<span class="sd">    :param original_problem: container of original problem</span>
<span class="sd">    :type original_problem: PyomoOriginalProblem</span>
<span class="sd">    :param cuts: container of linear constraints</span>
<span class="sd">    :type cuts: CutPoolCG</span>
<span class="sd">    :param sub_models: list of containers for variables from a single \</span>
<span class="sd">    block and local nonlinear constraints blockwise</span>
<span class="sd">    :type sub_models: list</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PyomoInputModel.__init__"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoInputModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="c1"># region preprocessing of pyomo model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remove_unpicklable_objects_pyomo_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decomposer</span> <span class="o">=</span> <span class="n">PyomoModelDecomposer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">model_sense</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomposer</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">blocks</span>  <span class="c1"># string names for the variables in the block</span>
        <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sense</span> <span class="o">=</span> <span class="n">model_sense</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="c1"># endregion</span>

        <span class="c1"># region construct cuts</span>
        <span class="n">block_sizes</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">global_cuts</span><span class="p">,</span> <span class="n">local_cuts</span> \
            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_cut_pool</span><span class="p">()</span>
        <span class="n">cuts</span> <span class="o">=</span> <span class="n">CutPoolCG</span><span class="p">(</span><span class="n">block_sizes</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">global_cuts</span><span class="p">,</span> <span class="n">local_cuts</span><span class="p">)</span>
        <span class="c1"># endregion</span>

        <span class="c1"># region construct sub_problems, original_problem</span>
        <span class="n">sub_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">PyomoSubModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">block_id</span><span class="p">],</span> <span class="n">block_id</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_blocks</span><span class="p">)]</span>
        <span class="n">sub_problems</span> <span class="o">=</span> <span class="p">[</span><span class="n">PyomoSubProblems</span><span class="p">(</span><span class="n">sub_models</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">block_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_blocks</span><span class="p">)]</span>

        <span class="n">original_problem</span> <span class="o">=</span> <span class="n">PyomoOriginalProblem</span><span class="p">(</span><span class="n">sub_models</span><span class="p">,</span>
                                                <span class="n">cuts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">)</span>
        <span class="c1"># endregion</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">sub_problems</span><span class="p">,</span> <span class="n">original_problem</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">sub_models</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyomoInputModel._construct_cut_pool"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoInputModel._construct_cut_pool">[docs]</a>    <span class="k">def</span> <span class="nf">_construct_cut_pool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">block_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">]</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span>

        <span class="c1"># region objective reading and initialization</span>
        <span class="n">obj_name</span><span class="p">,</span> <span class="n">objective</span> <span class="o">=</span> \
            <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">component_map</span><span class="p">(</span><span class="n">Objective</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">obj_expr</span> <span class="o">=</span> <span class="n">objective</span><span class="o">.</span><span class="n">expr</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="n">obj_expr</span><span class="o">.</span><span class="n">polynomial_degree</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">degree</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">degree</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Dev: Objective is not linear, check the reformulation&#39;</span><span class="p">)</span>
        <span class="n">coef</span><span class="p">,</span> <span class="n">obj_const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_linear_term_data</span><span class="p">(</span><span class="n">obj_expr</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">ObjectiveFunction</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">block_sizes</span><span class="p">,</span> <span class="n">obj_const</span><span class="p">)</span>
        <span class="c1"># endregion</span>

        <span class="c1"># region linear constraints reading and initialization</span>
        <span class="n">global_cuts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">local_cuts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">block_sizes</span><span class="p">)):</span>
            <span class="n">local_cuts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">block_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">block_data_objects</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">con_name</span><span class="p">,</span> <span class="n">con_obj</span> <span class="ow">in</span> \
                    <span class="n">block_obj</span><span class="o">.</span><span class="n">component_map</span><span class="p">(</span><span class="n">Constraint</span><span class="p">,</span>
                                            <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">con_obj</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">ScalarConstraint</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_read_constraint_object</span><span class="p">(</span><span class="n">con_obj</span><span class="p">,</span> <span class="n">local_cuts</span><span class="p">,</span>
                                                 <span class="n">global_cuts</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">con_obj</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">IndexedConstraint</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">con_obj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_read_constraint_object</span><span class="p">(</span><span class="n">con_obj</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">local_cuts</span><span class="p">,</span>
                                                     <span class="n">global_cuts</span><span class="p">)</span>
        <span class="c1"># endregion</span>

        <span class="k">return</span> <span class="n">block_sizes</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">global_cuts</span><span class="p">,</span> <span class="n">local_cuts</span></div>

<div class="viewcode-block" id="PyomoInputModel._read_constraint_object"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoInputModel._read_constraint_object">[docs]</a>    <span class="k">def</span> <span class="nf">_read_constraint_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">con_obj</span><span class="p">,</span> <span class="n">local_cuts</span><span class="p">,</span> <span class="n">global_cuts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads Pyomo constraints, detects if the constraint is linear.</span>
<span class="sd">        If yes, then it creates the linear constraint</span>

<span class="sd">        :param con_obj: Pyomo constraint object</span>
<span class="sd">        :type con_obj: Constraint</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">con_expr</span> <span class="o">=</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">body</span>
        <span class="k">if</span> <span class="n">con_expr</span><span class="o">.</span><span class="n">polynomial_degree</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">coef</span><span class="p">,</span> <span class="n">const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_linear_term_data</span><span class="p">(</span><span class="n">con_expr</span><span class="p">)</span>

            <span class="n">rhs</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">relation</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">equality</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">relation</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span>
                <span class="n">rhs</span> <span class="o">=</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">upper</span><span class="o">.</span><span class="n">value</span>
            <span class="k">elif</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">strict_upper</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">relation</span> <span class="o">=</span> <span class="s2">&quot;&lt;=&quot;</span>
                <span class="n">rhs</span> <span class="o">=</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">upper</span><span class="o">.</span><span class="n">value</span>
            <span class="k">elif</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">upper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">strict_upper</span><span class="p">:</span>
                <span class="n">relation</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span>
                <span class="n">rhs</span> <span class="o">=</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">upper</span><span class="o">.</span><span class="n">value</span>
            <span class="k">elif</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">strict_lower</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">relation</span> <span class="o">=</span> <span class="s2">&quot;&gt;=&quot;</span>
                <span class="n">rhs</span> <span class="o">=</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">lower</span><span class="o">.</span><span class="n">value</span>
            <span class="k">elif</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">lower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">strict_lower</span><span class="p">:</span>
                <span class="n">relation</span> <span class="o">=</span> <span class="s2">&quot;&gt;&quot;</span>
                <span class="n">rhs</span> <span class="o">=</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">lower</span><span class="o">.</span><span class="n">value</span>

            <span class="n">rhs</span> <span class="o">-=</span> <span class="n">const</span>
            <span class="n">lin_con</span> <span class="o">=</span> <span class="n">LinearConstraint</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">relation</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_sizes</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lin_con</span><span class="o">.</span><span class="n">is_local</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">local_cuts</span><span class="p">[</span><span class="n">lin_con</span><span class="o">.</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lin_con</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">global_cuts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lin_con</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyomoInputModel._get_linear_term_data"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoInputModel._get_linear_term_data">[docs]</a>    <span class="k">def</span> <span class="nf">_get_linear_term_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recursive function for reading and getting data for linear terms</span>

<span class="sd">        :param expr: Linear expression to parse</span>
<span class="sd">        :type expr: Expression</span>
<span class="sd">        :return: List of coefficients and constant</span>
<span class="sd">        :rtype: (list, int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coef</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">const</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">SumExpression</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="n">new_coef</span><span class="p">,</span> <span class="n">new_const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_linear_term_data</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">new_coef</span><span class="p">:</span>
                    <span class="n">coef</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">block_id</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
                <span class="n">const</span> <span class="o">+=</span> <span class="n">new_const</span>
        <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">MonomialTermExpression</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="n">coef_val</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                <span class="n">coef_val</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_variable_index_by_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
            <span class="n">coef</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">coef_val</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">NegationExpression</span><span class="p">:</span>
            <span class="n">new_coef</span><span class="p">,</span> <span class="n">new_const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_linear_term_data</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># multiply by -1, since it is negation expression</span>
            <span class="k">for</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">new_coef</span><span class="p">:</span>
                <span class="n">coef</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">block_id</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="o">-</span><span class="n">val</span><span class="p">))</span>
            <span class="n">const</span> <span class="o">-=</span> <span class="n">new_const</span>
        <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">ProductExpression</span><span class="p">:</span>
            <span class="c1"># if ProductExpression is here, than it is should be that one</span>
            <span class="c1"># argument is a number and the other is SumExpression</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="n">new_coef</span><span class="p">,</span> <span class="n">new_const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_linear_term_data</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">multiplier</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_coef</span><span class="p">,</span> <span class="n">new_const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_linear_term_data</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">multiplier</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">new_coef</span><span class="p">:</span>
                <span class="n">coef</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">block_id</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">multiplier</span> <span class="o">*</span> <span class="n">val</span><span class="p">))</span>
            <span class="n">const</span> <span class="o">+=</span> <span class="n">multiplier</span> <span class="o">*</span> <span class="n">new_const</span>
        <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">LinearExpression</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">linear_coefs</span><span class="p">):</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">linear_vars</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_variable_index_by_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                <span class="n">coef</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">Var</span> <span class="ow">or</span> <span class="n">expr</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">_GeneralVarData</span> <span class="ow">or</span> \
                <span class="n">expr</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">ScalarVar</span><span class="p">:</span>
            <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_variable_index_by_name</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">coef</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">const</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Dev: Found expression object type which was not considered&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coef</span><span class="p">,</span> <span class="n">const</span></div>

<div class="viewcode-block" id="PyomoInputModel._get_variable_index_by_name"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoInputModel._get_variable_index_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">_get_variable_index_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get variable index from the list of blocks for sparse vector</span>
<span class="sd">        initialization</span>

<span class="sd">        :param var_name: Original variable name</span>
<span class="sd">        :type var_name: str</span>
<span class="sd">        :return: Pair of indices: block id and index in the block</span>
<span class="sd">        :rtype: (int, int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># index for iteration over the blocks</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">j</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span></div>

<div class="viewcode-block" id="PyomoInputModel._remove_unpicklable_objects_pyomo_model"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoInputModel._remove_unpicklable_objects_pyomo_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remove_unpicklable_objects_pyomo_model</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes unpicklable objects from Pyomo model object. This is because</span>
<span class="sd">        multiprocessing is based on serialization and some objects cannot be</span>
<span class="sd">        serialized (pickled).</span>
<span class="sd">        This method does the following:</span>

<span class="sd">        * removes objects Port and Arcs, since they contain weakref objects</span>

<span class="sd">        * sets to None the &#39;rule&#39; property for Constraint, Objective and Param, \</span>
<span class="sd">        since it might contain lambda function</span>

<span class="sd">        * sets to None property &#39;initialize&#39; and &#39;_init_values._init&#39; for Set, \</span>
<span class="sd">        since it might contain lambda function</span>

<span class="sd">        :param model: Pyomo model</span>
<span class="sd">        :type model: ConcreteModel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">block_obj</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">block_data_objects</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">block_obj</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span><span class="n">Port</span><span class="p">):</span>
                <span class="n">block_obj</span><span class="o">.</span><span class="n">del_component</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">arc</span> <span class="ow">in</span> <span class="n">block_obj</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span><span class="n">Arc</span><span class="p">):</span>
                <span class="n">block_obj</span><span class="o">.</span><span class="n">del_component</span><span class="p">(</span><span class="n">arc</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span>
                <span class="p">[</span><span class="n">Objective</span><span class="p">,</span> <span class="n">Constraint</span><span class="p">,</span> <span class="n">Param</span><span class="p">,</span> <span class="n">Block</span><span class="p">]):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_rule</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># if here some exceptions occur, then check whether attributes still</span>
        <span class="c1"># exist</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">component_objects</span><span class="p">([</span><span class="n">Set</span><span class="p">]):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_init_values</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">initialize</span> <span class="o">=</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="PyomoOriginalProblem"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoOriginalProblem">[docs]</a><span class="k">class</span> <span class="nc">PyomoOriginalProblem</span><span class="p">(</span><span class="n">OriginalProblemBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;User-defined local solve for pyomo MINLP problems</span>

<span class="sd">    :param cuts: Container which stores all linear constraints \</span>
<span class="sd">    (global and local) and objective function</span>
<span class="sd">    :type cuts: CutPoolCG</span>
<span class="sd">    :param sub_models: List of sub-models</span>
<span class="sd">    :type sub_models: list</span>
<span class="sd">    :param nlp_problem: NLP master problem</span>
<span class="sd">    :type nlp_problem: NlpProblem</span>
<span class="sd">    :param mip_projection_master_problem: MIP projection master problem</span>
<span class="sd">    :type mip_projection_problem: MipProjectionMasterProblem</span>
<span class="sd">    :param nlp_resource_projection_problem: NLP projection master problem</span>
<span class="sd">    :type nlp_resource_projection_problem: NlpResourceProjectionProblem</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PyomoOriginalProblem.__init__"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoOriginalProblem.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub_models</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor method&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span>
        <span class="c1"># NLP master problems</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp_problem</span> <span class="o">=</span> <span class="n">NlpProblem</span><span class="p">(</span><span class="n">sub_models</span><span class="p">,</span> <span class="n">cuts</span><span class="p">)</span>

        <span class="c1"># projection problems</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mip_projection_problem</span> <span class="o">=</span> \
            <span class="n">MipProjectionMasterProblem</span><span class="p">(</span><span class="n">sub_models</span><span class="p">,</span> <span class="n">cuts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp_resource_projection_problem</span> <span class="o">=</span> \
            <span class="n">NlpResourceProjectionProblem</span><span class="p">(</span><span class="n">sub_models</span><span class="p">,</span> <span class="n">cuts</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyomoOriginalProblem.local_solve_fast"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoOriginalProblem.local_solve_fast">[docs]</a>    <span class="k">def</span> <span class="nf">local_solve_fast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># solve NLP resource projection problem</span>
        <span class="n">tilde_y</span><span class="p">,</span> <span class="n">obj_val_nlp_1st</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">solve_nlp_resource_proj_problem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">nlp_solver</span><span class="p">,</span>
                                                 <span class="n">point_to_project</span><span class="o">=</span><span class="n">start_point</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sol_is_feasible</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-------------------------------------&#39;</span><span class="p">)</span>
            <span class="c1"># tilde_y: NLP project point</span>
            <span class="n">c_tilde_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlp_problem</span><span class="o">.</span><span class="n">cuts</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">tilde_y</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;solve_nlp_resource_proj obj: </span><span class="si">{0}</span><span class="s1"> &#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">sense</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">c_tilde_y</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-------------------------------------&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-------------------------------------&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;solve_nlp_resource_proj not feasible&#39;</span><span class="p">)</span>
            <span class="n">c_tilde_y</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-------------------------------------&#39;</span><span class="p">)</span>

        <span class="n">c_tilde_x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">sol_is_feasible</span><span class="p">:</span>
            <span class="c1"># solve MIP project problem</span>
            <span class="n">hat_x</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">solve_mip_proj_problem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">mip_solver</span><span class="p">,</span>
                                            <span class="n">point_to_project</span><span class="o">=</span><span class="n">tilde_y</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sol_is_feasible</span><span class="p">:</span>
                <span class="c1"># NLP problem with fixed integers</span>
                <span class="n">tilde_x</span><span class="p">,</span> <span class="n">obj_val</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">nlp_solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">nlp_solver</span><span class="p">,</span>
                                   <span class="n">point_to_fix</span><span class="o">=</span><span class="n">hat_x</span><span class="p">,</span>
                                   <span class="n">start_point</span><span class="o">=</span><span class="n">hat_x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-------------------------------------&#39;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;solve_mip_projct_problem not feasible&#39;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-------------------------------------&#39;</span><span class="p">)</span>

            <span class="c1"># testing findSol</span>
            <span class="k">if</span> <span class="n">sol_is_feasible</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-------------------------------------&#39;</span><span class="p">)</span>
                <span class="c1"># tilde_x: fixed NLP solution</span>
                <span class="n">c_tilde_x</span> <span class="o">=</span> <span class="n">obj_val</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;solve_fixed_nlp_problem obj: </span><span class="si">{0}</span><span class="s1"> &#39;</span>
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">sense</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">c_tilde_x</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-------------------------------------&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-------------------------------------&#39;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;solve_fixed_nlp_problem not feasible&#39;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-------------------------------------&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sol_is_feasible</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0: &lt;50}{1: &lt;30}</span><span class="s1">&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Gap (c_tilde_y &#39;</span>
                                <span class="s1">&#39;and c_tilde_x):&#39;</span><span class="p">,</span>
                                <span class="n">result</span><span class="o">.</span><span class="n">get_gap</span><span class="p">(</span><span class="n">c_tilde_x</span><span class="p">,</span> <span class="n">c_tilde_y</span><span class="p">)))</span>

            <span class="n">result</span><span class="o">.</span><span class="n">set_new_primal_bound</span><span class="p">(</span><span class="n">obj_val</span><span class="p">,</span> <span class="n">tilde_x</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp_problem</span><span class="o">.</span><span class="n">cuts</span><span class="o">.</span><span class="n">num_blocks</span><span class="p">):</span>
                <span class="n">problem</span><span class="o">.</span><span class="n">add_inner_point</span><span class="p">(</span>
                    <span class="n">k</span><span class="p">,</span> <span class="n">tilde_x</span><span class="o">.</span><span class="n">get_block</span><span class="p">(</span><span class="n">k</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">cg_min_inner_point_distance</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">After solving fixed NLP projection problem, &#39;</span>
                        <span class="s1">&#39;the solution point is feasible&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">iter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># this is for printing number of iteration</span>
                <span class="c1"># in the logger when generating feasible candidate</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0: &lt;50}{1: &lt;30}</span><span class="s1">&#39;</span>
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Projection Gap (c(x_NLP_proj) &#39;</span>
                                    <span class="s1">&#39;and primal bound):&#39;</span><span class="p">,</span>
                                    <span class="n">result</span><span class="o">.</span><span class="n">get_gap</span><span class="p">(</span>
                                        <span class="n">result</span><span class="o">.</span><span class="n">primal_bound</span><span class="p">,</span> <span class="n">c_tilde_y</span><span class="p">)))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Feasible candidate obtained in this &#39;</span>
                            <span class="s1">&#39;iteration: </span><span class="si">{0}</span><span class="s1">&#39;</span>
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">sense</span> <span class="o">*</span> <span class="n">obj_val</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0: &lt;50}{1: &lt;30}</span><span class="s1">&#39;</span>
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Projection Gap (c(x_NLP_proj) &#39;</span>
                                    <span class="s1">&#39;and primal bound):&#39;</span><span class="p">,</span>
                                    <span class="n">result</span><span class="o">.</span><span class="n">get_gap</span><span class="p">(</span>
                                        <span class="n">result</span><span class="o">.</span><span class="n">primal_bound</span><span class="p">,</span> <span class="n">c_tilde_y</span><span class="p">)))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Feasible candidate obtained in &#39;</span>
                            <span class="s1">&#39;iter </span><span class="si">{0}</span><span class="s1">: </span><span class="si">{1}</span><span class="s1">&#39;</span>
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">iter</span><span class="p">),</span>
                                    <span class="n">result</span><span class="o">.</span><span class="n">sense</span> <span class="o">*</span> <span class="n">obj_val</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">iter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># this is for printing number of</span>
                <span class="c1"># iteration in the logger when generating feasible candidate</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">No feasible candidate obtained in this &#39;</span>
                            <span class="s1">&#39;iteration&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">No feasible candidate obtained in iter </span><span class="si">{0}</span><span class="s1">&#39;</span>
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">iter</span><span class="p">)))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">=======================================================&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyomoOriginalProblem.local_solve"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoOriginalProblem.local_solve">[docs]</a>    <span class="k">def</span> <span class="nf">local_solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">mip_solver</span> <span class="o">=</span> <span class="s1">&#39;gurobi_persistent&#39;</span>
        <span class="n">pool_solutions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">cg_find_sol_mip_pool</span>

        <span class="n">old_feasible_obj_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">cg_find_sol_mip_pool_tau</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">---------------------------------------------------&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Local search iter </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

            <span class="n">hat_x_list</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">solve_mip_proj_problem</span><span class="p">(</span><span class="n">solver_name</span><span class="o">=</span><span class="n">mip_solver</span><span class="p">,</span>
                                            <span class="n">point_to_project</span><span class="o">=</span><span class="n">start_point</span><span class="p">,</span>
                                            <span class="n">pool_solutions</span><span class="o">=</span><span class="n">pool_solutions</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sol_is_feasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;mip proj problem is infeasible&#39;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="n">i_max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hat_x_list</span><span class="p">)</span>
            <span class="n">hat_x</span> <span class="o">=</span> <span class="n">hat_x_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Solution pool generated from &#39;</span>
                        <span class="s1">&#39;solving MIP project problem: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i_max</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Solution pool: solution 1&#39;</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">feasible_obj_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
            <span class="n">feasible_obj_point</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">c_hat_x</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">block_model</span><span class="o">.</span><span class="n">cuts</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">hat_x</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;---------------MIP-projection--------------------&#39;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;c_hat_x: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c_hat_x</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;-------------------------------------------------&#39;</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># NLP problem with fixed integers</span>
                    <span class="n">tilde_x</span><span class="p">,</span> <span class="n">obj_val</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">nlp_solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">nlp_solver</span><span class="p">,</span>
                                       <span class="n">point_to_fix</span><span class="o">=</span><span class="n">hat_x</span><span class="p">,</span>
                                       <span class="n">start_point</span><span class="o">=</span><span class="n">hat_x</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">sol_is_feasible</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">sol_is_feasible</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">improved</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">set_new_primal_bound</span><span class="p">(</span><span class="n">obj_val</span><span class="p">,</span> <span class="n">tilde_x</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">obj_val</span> <span class="o">&lt;</span> <span class="n">feasible_obj_val</span><span class="p">:</span>
                        <span class="n">feasible_obj_val</span> <span class="o">=</span> <span class="n">obj_val</span>
                        <span class="n">feasible_obj_point</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tilde_x</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">block_model</span><span class="o">.</span><span class="n">num_blocks</span><span class="p">):</span>
                        <span class="n">problem</span><span class="o">.</span><span class="n">add_inner_point</span><span class="p">(</span>
                            <span class="n">k</span><span class="p">,</span> <span class="n">tilde_x</span><span class="o">.</span><span class="n">get_block</span><span class="p">(</span><span class="n">k</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">cg_min_inner_point_distance</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">After solving fixed NLP projection problem, &#39;</span>
                                <span class="s1">&#39;the solution point is feasible&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">improved</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;the feasible solution point improves&#39;</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Obj. value: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">sense</span> <span class="o">*</span> <span class="n">result</span><span class="o">.</span><span class="n">primal_bound</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;the feasible solution point does &#39;</span>
                                    <span class="s1">&#39;not improve&#39;</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Obj. value: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">sense</span> <span class="o">*</span> <span class="n">obj_val</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">After solving fixed NLP the solution point is &#39;</span>
                        <span class="s1">&#39;infeasible&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">iter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sol_is_feasible</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># this is</span>
                    <span class="c1"># for printing number of iteration in</span>
                    <span class="c1"># the logger when generating feasible candidate</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Feasible candidate obtained in this &#39;</span>
                                <span class="s1">&#39;iteration: </span><span class="si">{0}</span><span class="s1">&#39;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">sense</span> <span class="o">*</span> <span class="n">obj_val</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sol_is_feasible</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Feasible candidate &#39;</span>
                                <span class="s1">&#39;obtained in iter </span><span class="si">{0}</span><span class="s1">: round </span><span class="si">{1}</span><span class="s1">: pool </span><span class="si">{2}</span><span class="s1">: </span><span class="si">{3}</span><span class="s1">&#39;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">iter</span><span class="p">),</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
                                        <span class="n">result</span><span class="o">.</span><span class="n">sense</span> <span class="o">*</span> <span class="n">obj_val</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sol_is_feasible</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;No feasible candidate &#39;</span>
                                <span class="s1">&#39;obtained in iter </span><span class="si">{0}</span><span class="s1">: round </span><span class="si">{1}</span><span class="s1">: pool </span><span class="si">{2}</span><span class="s1">&#39;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">iter</span><span class="p">),</span> <span class="n">ii</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">i_max</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hat_x</span> <span class="o">=</span> <span class="n">hat_x_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Solution pool: solution </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">feasible_obj_val</span> <span class="o">&lt;</span> <span class="n">old_feasible_obj_val</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">---------------------------------------------------&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">iter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">feasible_obj_val</span> \
                        <span class="ow">is</span> <span class="ow">not</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Best feasible candidate obtained in this &#39;</span>
                                <span class="s1">&#39;iteration: </span><span class="si">{0}</span><span class="s1">&#39;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">sense</span> <span class="o">*</span>
                                        <span class="n">feasible_obj_val</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">feasible_obj_val</span> \
                        <span class="ow">is</span> <span class="ow">not</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Best feasible candidate &#39;</span>
                                <span class="s1">&#39;obtained in iter </span><span class="si">{0}</span><span class="s1">: </span><span class="si">{1}</span><span class="s1">&#39;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">iter</span><span class="p">),</span>
                                        <span class="n">result</span><span class="o">.</span><span class="n">sense</span> <span class="o">*</span>
                                        <span class="n">feasible_obj_val</span><span class="p">))</span>

                <span class="n">start_point</span> <span class="o">=</span> <span class="n">start_point</span> <span class="o">*</span> <span class="n">tau</span> <span class="o">+</span> <span class="n">feasible_obj_point</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">tau</span><span class="p">)</span>
                <span class="n">old_feasible_obj_val</span> <span class="o">=</span> <span class="n">feasible_obj_val</span>
                <span class="n">ii</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Local search iter </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;New search does not find better &#39;</span>
                            <span class="s1">&#39;local feasible solution&#39;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">cg_find_sol_mip_pool_max_round</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;reaches local search round limit </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span>
                <span class="k">break</span></div>

<div class="viewcode-block" id="PyomoOriginalProblem.nlp_solve"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoOriginalProblem.nlp_solve">[docs]</a>    <span class="k">def</span> <span class="nf">nlp_solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver_name</span><span class="p">,</span> <span class="n">point_to_fix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_point</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">cut_direction</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Solves :class:`~problem.nlp_master_problem.NlpProblem`.</span>
<span class="sd">        Solved mostly with fixed integer variables</span>

<span class="sd">        :param solver_name: External solver name</span>
<span class="sd">        :type solver_name: str</span>
<span class="sd">        :param point_to_fix: Point to be fixed using the integer variables</span>
<span class="sd">        :type point_to_fix: BlockVector</span>
<span class="sd">        :param start_point: Point for the warm start for the external solver</span>
<span class="sd">        :type start_point: BlockVector</span>
<span class="sd">        :param cut_direction: Objective direction</span>
<span class="sd">        :type cut_direction: BlockVector</span>
<span class="sd">        :return: Solution point, objective value, flag if the solution point \</span>
<span class="sd">        is feasible</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">point_to_fix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nlp_problem</span><span class="o">.</span><span class="n">fix_integers</span><span class="p">(</span><span class="n">point_to_fix</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cut_direction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nlp_problem</span><span class="o">.</span><span class="n">set_new_objective</span><span class="p">(</span><span class="n">cut_direction</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">obj_val</span><span class="p">,</span> <span class="n">duals</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">nlp_problem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver_name</span><span class="p">,</span>
                                   <span class="n">start_point</span><span class="o">=</span><span class="n">start_point</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">point_to_fix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nlp_problem</span><span class="o">.</span><span class="n">unfix_all_variables</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cut_direction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nlp_problem</span><span class="o">.</span><span class="n">set_default_objective</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">obj_val</span><span class="p">,</span> <span class="n">sol_is_feasible</span></div>

<div class="viewcode-block" id="PyomoOriginalProblem.solve_mip_proj_problem"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoOriginalProblem.solve_mip_proj_problem">[docs]</a>    <span class="k">def</span> <span class="nf">solve_mip_proj_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver_name</span><span class="p">,</span> <span class="n">point_to_project</span><span class="p">,</span>
                               <span class="n">target_value</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="n">pool_solutions</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Solves</span>
<span class="sd">        :class:`~problem.projection_master_problem.MipProjectionMasterProblem`</span>

<span class="sd">        :param solver_name: External solver name</span>
<span class="sd">        :type solver_name: str</span>
<span class="sd">        :param point_to_project: Point to project from, it is in the original \</span>
<span class="sd">        space</span>
<span class="sd">        :type point_to_project: BlockVector</span>
<span class="sd">        :return: Solution point, objective value</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mip_projection_problem</span><span class="o">.</span><span class="n">set_projection_point</span><span class="p">(</span>
            <span class="n">point_to_project</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mip_projection_problem</span><span class="o">.</span><span class="n">update_optimality_cut</span><span class="p">(</span><span class="n">target_value</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">obj_val</span><span class="p">,</span> <span class="n">duals</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">mip_projection_problem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver_name</span><span class="p">,</span> <span class="n">pool_solutions</span>
                                              <span class="o">=</span><span class="n">pool_solutions</span><span class="p">)</span>
        <span class="c1"># depending on solver name, x can contain more solution points</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">obj_val</span><span class="p">,</span> <span class="n">sol_is_feasible</span></div>

<div class="viewcode-block" id="PyomoOriginalProblem.solve_nlp_resource_proj_problem"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoOriginalProblem.solve_nlp_resource_proj_problem">[docs]</a>    <span class="k">def</span> <span class="nf">solve_nlp_resource_proj_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver_name</span><span class="p">,</span> <span class="n">point_to_project</span><span class="p">,</span>
                                        <span class="n">target_value</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span>
                                        <span class="n">start_point</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Solves</span>
<span class="sd">        :class:`~problem.projection_master_problem.NlpResourceProjectionProblem`</span>

<span class="sd">        :param solver_name: External solver name</span>
<span class="sd">        :type solver_name: str</span>
<span class="sd">        :param point_to_project: Point to project from, it is in the image space</span>
<span class="sd">        :type point_to_project: BlockVector</span>
<span class="sd">        :param start_point: Starting point for external solver</span>
<span class="sd">        :type start_point: BlockVector</span>
<span class="sd">        :return: Solution point, objective value, flag indicating if the \</span>
<span class="sd">        solution point is infeasible, \</span>
<span class="sd">        slack value of the soft fixing of target cut</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nlp_resource_projection_problem</span>\
            <span class="o">.</span><span class="n">set_projection_point</span><span class="p">(</span><span class="n">point_to_project</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp_resource_projection_problem</span><span class="o">.</span><span class="n">update_optimality_cut</span><span class="p">(</span><span class="n">target_value</span><span class="p">)</span>

        <span class="n">x_sol</span><span class="p">,</span> <span class="n">obj_val</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">nlp_resource_projection_problem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver_name</span><span class="p">,</span>
                                                       <span class="n">start_point</span><span class="o">=</span>
                                                       <span class="n">start_point</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x_sol</span><span class="p">,</span> <span class="n">obj_val</span><span class="p">,</span> <span class="n">sol_is_feasible</span></div></div>


<div class="viewcode-block" id="PyomoSubModel"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubModel">[docs]</a><span class="k">class</span> <span class="nc">PyomoSubModel</span><span class="p">(</span><span class="n">SubModelBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Container class which stores the variables from the single block and</span>
<span class="sd">    local nonlinear constraints.</span>

<span class="sd">    :param model: Input Pyomo model</span>
<span class="sd">    :type model: ConcreteModel</span>
<span class="sd">    :param vars_in_block: List of original variable names from the model</span>
<span class="sd">    :type vars_in_block: list</span>
<span class="sd">    :param block_id: Identifier for block</span>
<span class="sd">    :type block_id: int</span>
<span class="sd">    :param variables: List of all variables with all necessary properties</span>
<span class="sd">    :type variables: list</span>
<span class="sd">    :param block_size: Number of variables in the sub-model</span>
<span class="sd">    :type block_size: int</span>
<span class="sd">    :param integer: Indicates if the current sub-model contains variable of \</span>
<span class="sd">    integer type</span>
<span class="sd">    :type integer: bool</span>
<span class="sd">    :param nonlin_constr: List of local nonlinear constraints stored using \</span>
<span class="sd">    original Pyomo expression</span>
<span class="sd">    :type nonlin_constr: list</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PyomoSubModel.__init__"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">vars_in_block</span><span class="p">,</span> <span class="n">block_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor method&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vars_in_block</span><span class="p">,</span> <span class="n">block_id</span><span class="p">)</span>

        <span class="c1"># region Var creation</span>
        <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_in_block</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">find_component</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">VarDomain</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">ub</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">lb</span><span class="p">,</span> <span class="n">var</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Binary&#39;</span> <span class="ow">or</span> <span class="n">var</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Integers&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># endregion</span>

        <span class="c1"># region creating NonlinearConstraint</span>
        <span class="k">for</span> <span class="n">block_obj</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">block_data_objects</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">con_name</span><span class="p">,</span> <span class="n">con_obj</span> <span class="ow">in</span> \
                    <span class="n">block_obj</span><span class="o">.</span><span class="n">component_map</span><span class="p">(</span><span class="n">Constraint</span><span class="p">,</span>
                                            <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con_obj</span><span class="p">,</span> <span class="n">ScalarConstraint</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_nonlinear_constraint</span><span class="p">(</span><span class="n">con_obj</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">con_obj</span><span class="p">,</span> <span class="n">IndexedConstraint</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">con_obj</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">read_nonlinear_constraint</span><span class="p">(</span><span class="n">con_obj</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                         <span class="s1">&#39;Dev: Found constraints object type which &#39;</span>
                         <span class="s1">&#39;was not considered&#39;</span><span class="p">)</span>
        <span class="c1"># endregion</span>

        <span class="c1"># check if block is linear</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nonlin_constr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PyomoSubModel.read_nonlinear_constraint"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubModel.read_nonlinear_constraint">[docs]</a>    <span class="k">def</span> <span class="nf">read_nonlinear_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">con_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines if the given constraint belongs to this sub-model.</span>
<span class="sd">        If yes, it adds to the list of nonlinear constraints by copying the</span>
<span class="sd">        Pyomo expression</span>

<span class="sd">        :param con_obj: Pyomo constraint object</span>
<span class="sd">        :type con_obj: ScalarConstraint or IndexedConstraint</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">con_expr</span> <span class="o">=</span> <span class="n">con_obj</span><span class="o">.</span><span class="n">body</span>
        <span class="n">degree</span> <span class="o">=</span> <span class="n">con_expr</span><span class="o">.</span><span class="n">polynomial_degree</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">degree</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">degree</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># check if constraint belongs to the current block</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_vars_in_block</span><span class="p">(</span><span class="n">con_obj</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nonlin_constr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">NonLinearConstraint</span><span class="p">(</span><span class="n">con_obj</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">vars_in_block</span><span class="p">))</span></div>

<div class="viewcode-block" id="PyomoSubModel.constraint_vars_in_block"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubModel.constraint_vars_in_block">[docs]</a>    <span class="k">def</span> <span class="nf">constraint_vars_in_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the Pyomo expression belongs to the current sub-model</span>

<span class="sd">        :param expr: Pyomo expression.</span>
<span class="sd">        :type expr: Expression</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vars_in_expr</span> <span class="o">=</span> <span class="n">identify_variables</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="n">contained</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_in_expr</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_in_block</span><span class="p">:</span>
                <span class="n">contained</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">contained</span></div>

<div class="viewcode-block" id="PyomoSubModel.compute_gradients"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubModel.compute_gradients">[docs]</a>    <span class="k">def</span> <span class="nf">compute_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes gradients for each nonlinear constraint and stores in the</span>
<span class="sd">        constraint object&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlin_constr</span><span class="p">:</span>
            <span class="n">con</span><span class="o">.</span><span class="n">compute_gradient</span><span class="p">()</span></div>

<div class="viewcode-block" id="PyomoSubModel.round"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubModel.round">[docs]</a>    <span class="k">def</span> <span class="nf">round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Round point to the closest integer</span>

<span class="sd">        :param point: Given point</span>
<span class="sd">        :type point: ndarray</span>
<span class="sd">        :return: New rounded point</span>
<span class="sd">        :rtype: ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rounded_point</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;Integers&#39;</span> <span class="ow">or</span> <span class="n">var</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;Binary&#39;</span><span class="p">:</span>
                <span class="n">rounded_point</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">rounded_point</span></div></div>


<div class="viewcode-block" id="PyomoSubProblems"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems">[docs]</a><span class="k">class</span> <span class="nc">PyomoSubProblems</span><span class="p">(</span><span class="n">SubProblemsBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Container class for managing all sub-problems</span>

<span class="sd">    :param minlp_sub_problem: Sub-probem with linear objective</span>
<span class="sd">    :type minlp_sub_problem: PyomoMinlpSubProblem</span>
<span class="sd">    :param proj_sub_problem: Pure projection sub-problem</span>
<span class="sd">    :type proj_sub_problem: PyomoProjectionSubProblem</span>
<span class="sd">    :param resource_constrained_sub_problem: Resource constrained sub-problem \</span>
<span class="sd">    for checking the feasibility of the resources</span>
<span class="sd">    :type resource_constrained_sub_problem: PyomoResourceConstrainedSubProblem</span>
<span class="sd">    :param line_search_sub_problem: Line search sub-problem</span>
<span class="sd">    :type line_search_sub_problem: PyomoLineSearchSubProblem</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PyomoSubProblems.__init__"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sub_models</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">block_id</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor method</span>
<span class="sd">        :param approx_data:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_id</span> <span class="o">=</span> <span class="n">block_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">=</span> <span class="n">sub_models</span><span class="p">[</span><span class="n">block_id</span><span class="p">]</span><span class="o">.</span><span class="n">integer</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">block_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span> <span class="o">=</span> \
            <span class="n">PyomoMinlpSubProblem</span><span class="p">(</span><span class="n">sub_models</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">block_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">proj_sub_problem</span> <span class="o">=</span> \
            <span class="n">PyomoProjectionSubProblem</span><span class="p">(</span><span class="n">sub_models</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">block_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">line_search_sub_problem</span> <span class="o">=</span> \
            <span class="n">PyomoLineSearchSubProblem</span><span class="p">(</span><span class="n">sub_models</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">block_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resource_proj_sub_problem</span> <span class="o">=</span> \
            <span class="n">PyomoResourceProjectionSubProblem</span><span class="p">(</span><span class="n">sub_models</span><span class="p">,</span> <span class="n">cuts</span><span class="p">,</span> <span class="n">block_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyomoSubProblems.global_solve"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems.global_solve">[docs]</a>    <span class="k">def</span> <span class="nf">global_solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">start_point</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">solver_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">minlp_solver</span>
        <span class="n">solver_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get_minlp_solver_options</span><span class="p">()</span>

        <span class="n">y_new</span><span class="p">,</span> <span class="n">primal_bound</span><span class="p">,</span> <span class="n">dual_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_solve</span><span class="p">(</span><span class="n">solver_name</span><span class="p">,</span> <span class="n">solver_options</span><span class="o">=</span><span class="n">solver_options</span><span class="p">,</span>
                             <span class="n">start_point</span><span class="o">=</span><span class="n">start_point</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">y_new</span><span class="p">,</span> <span class="n">primal_bound</span><span class="p">,</span> <span class="n">dual_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span></div>

<div class="viewcode-block" id="PyomoSubProblems.local_solve"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems.local_solve">[docs]</a>    <span class="k">def</span> <span class="nf">local_solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">start_point</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">solver_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">get_nlp_solver_options</span><span class="p">()</span>
        <span class="c1"># in order to solve NLP relaxation of MINLP problem it is not</span>
        <span class="c1"># necessary explicitly to relax integer variables</span>
        <span class="c1"># the NLP solver simply treats them as continuous variables</span>
        <span class="n">unfixed_tilde_y</span><span class="p">,</span> <span class="n">new_point_obj_val</span><span class="p">,</span> <span class="n">dual_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_solve</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">nlp_solver</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
                <span class="n">solver_options</span><span class="o">=</span><span class="n">solver_options</span><span class="p">,</span> <span class="n">start_point</span><span class="o">=</span><span class="n">start_point</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">cg_num_fixed_nlp_problems</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">rounded_point</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">sub_model</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
                    <span class="n">unfixed_tilde_y</span><span class="p">)</span>
            <span class="c1"># start_point is used for fixing the integers</span>
            <span class="n">tilde_y</span><span class="p">,</span> <span class="n">new_point_obj_val</span><span class="p">,</span> <span class="n">dual_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">fixed_minlp_solve</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">nlp_solver</span><span class="p">,</span>
                    <span class="n">start_point</span><span class="o">=</span><span class="n">rounded_point</span><span class="p">,</span>
                    <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
                    <span class="n">solver_options</span><span class="o">=</span><span class="n">solver_options</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">tilde_y</span> <span class="o">=</span> <span class="n">unfixed_tilde_y</span>

        <span class="k">return</span> <span class="n">tilde_y</span><span class="p">,</span> <span class="n">new_point_obj_val</span><span class="p">,</span> <span class="n">dual_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span></div>

<div class="viewcode-block" id="PyomoSubProblems.minlp_solve"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems.minlp_solve">[docs]</a>    <span class="k">def</span> <span class="nf">minlp_solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver_name</span><span class="p">,</span> <span class="n">solver_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_point</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Solves :class:`MinlpSubProblem`</span>

<span class="sd">        :param solver_name: External solver name</span>
<span class="sd">        :type solver_name: str</span>
<span class="sd">        :param solver_options: External solver options, defaults to ``None``</span>
<span class="sd">        :type solver_options: list or None</span>
<span class="sd">        :param start_point: Staring point for the solver, defaults to ``None``</span>
<span class="sd">        :type start_point: ndarray or None</span>
<span class="sd">        :param direction: Direction for the objective, defaults to ``None``</span>
<span class="sd">        :type direction: ndarray or None</span>
<span class="sd">        :param cell: Cell, defaults to ``None``</span>
<span class="sd">        :type cell: Cell or None</span>
<span class="sd">        :return: Solution point, primal and dual bound</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">add_objective</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cell</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">add_cell_constraints</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

        <span class="n">y_new</span><span class="p">,</span> <span class="n">primal_bound</span><span class="p">,</span> <span class="n">dual_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver_name</span><span class="p">,</span>
                                         <span class="n">solver_options</span><span class="o">=</span><span class="n">solver_options</span><span class="p">,</span>
                                         <span class="n">start_point</span><span class="o">=</span><span class="n">start_point</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cell</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">remove_cell_constraints</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">y_new</span><span class="p">,</span> <span class="n">primal_bound</span><span class="p">,</span> <span class="n">dual_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span></div>

<div class="viewcode-block" id="PyomoSubProblems.fixed_minlp_solve"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems.fixed_minlp_solve">[docs]</a>    <span class="k">def</span> <span class="nf">fixed_minlp_solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver_name</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">solver_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Solves :class:`MinlpSubProblem` with fixed integer variables</span>

<span class="sd">        :param solver_name: External solver name</span>
<span class="sd">        :type solver_name: str</span>
<span class="sd">        :param start_point: Staring point for the solver, and point which is \</span>
<span class="sd">        used for fixing the integers</span>
<span class="sd">        :type start_point: ndarray or None</span>
<span class="sd">        :param solver_options: External solver options, defaults to ``None``</span>
<span class="sd">        :type solver_options: list or None</span>
<span class="sd">        :param direction: Direction for the objective, defaults to ``None``</span>
<span class="sd">        :type direction: ndarray or None</span>
<span class="sd">        :param cell: Cell, defaults to ``None``</span>
<span class="sd">        :type cell: Cell or None</span>
<span class="sd">        :return: Solution point, primal and dual bound</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">add_objective</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cell</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">add_cell_constraints</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">fix_integers</span><span class="p">(</span><span class="n">start_point</span><span class="p">)</span>

        <span class="n">y_new</span><span class="p">,</span> <span class="n">primal_bound</span><span class="p">,</span> <span class="n">dual_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver_name</span><span class="p">,</span>
                                         <span class="n">solver_options</span><span class="o">=</span><span class="n">solver_options</span><span class="p">,</span>
                                         <span class="n">start_point</span><span class="o">=</span><span class="n">start_point</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">unfix_integers</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cell</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">remove_cell_constraints</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">y_new</span><span class="p">,</span> <span class="n">primal_bound</span><span class="p">,</span> <span class="n">dual_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span></div>

<div class="viewcode-block" id="PyomoSubProblems.nlp_proj_solve"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems.nlp_proj_solve">[docs]</a>    <span class="k">def</span> <span class="nf">nlp_proj_solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver_name</span><span class="p">,</span> <span class="n">point_to_project</span><span class="p">,</span> <span class="n">start_point</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Solves :class:`ProjSubProblem`</span>

<span class="sd">        :param solver_name: External solver name</span>
<span class="sd">        :type solver_name: str</span>
<span class="sd">        :param point_to_project: Projection point</span>
<span class="sd">        :type point_to_project: ndarray</span>
<span class="sd">        :param start_point: Staring point for the solver, defaults to ``None``</span>
<span class="sd">        :type start_point: ndarray or None</span>
<span class="sd">        :return: Solution point, primal bound and flag indicating the \</span>
<span class="sd">        feasibility of primal solution</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proj_sub_problem</span><span class="o">.</span><span class="n">set_projection_point</span><span class="p">(</span><span class="n">point_to_project</span><span class="p">)</span>

        <span class="n">y_new</span><span class="p">,</span> <span class="n">primal_bound</span><span class="p">,</span> <span class="n">dual_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">proj_sub_problem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver_name</span><span class="p">,</span>
                                        <span class="n">start_point</span><span class="o">=</span><span class="n">start_point</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">y_new</span><span class="p">,</span> <span class="n">primal_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span></div>

<div class="viewcode-block" id="PyomoSubProblems.resource_proj_solve"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems.resource_proj_solve">[docs]</a>    <span class="k">def</span> <span class="nf">resource_proj_solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver_name</span><span class="p">,</span> <span class="n">point_to_project</span><span class="p">,</span>
                            <span class="n">solver_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_point</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Solves :class:`ResourceProjSubProblem`</span>

<span class="sd">        :param solver_name: External solver name</span>
<span class="sd">        :type solver_name: str</span>
<span class="sd">        :param point_to_project: Projection point</span>
<span class="sd">        :type point_to_project: ndarray</span>
<span class="sd">        :param start_point: Staring point for the solver, defaults to ``None``</span>
<span class="sd">        :type start_point: ndarray or None</span>
<span class="sd">        :return: Solution point, primal bound and flag indicating the \</span>
<span class="sd">        feasibility of primal solution</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource_proj_sub_problem</span><span class="o">.</span><span class="n">set_projection_point</span><span class="p">(</span><span class="n">point_to_project</span><span class="p">)</span>

        <span class="n">y_new</span><span class="p">,</span> <span class="n">primal_bound</span><span class="p">,</span> <span class="n">dual_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">resource_proj_sub_problem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver_name</span><span class="p">,</span>
                                                 <span class="n">start_point</span><span class="o">=</span><span class="n">start_point</span><span class="p">,</span>
                                                 <span class="n">solver_options</span><span class="o">=</span><span class="n">solver_options</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">y_new</span><span class="p">,</span> <span class="n">primal_bound</span><span class="p">,</span> <span class="n">sol_is_feasible</span></div>

<div class="viewcode-block" id="PyomoSubProblems.solve_line_search_subproblem"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems.solve_line_search_subproblem">[docs]</a>    <span class="k">def</span> <span class="nf">solve_line_search_subproblem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver_name</span><span class="p">,</span> <span class="n">exterior_point</span><span class="p">,</span>
                                     <span class="n">interior_point</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Solves :class:`LineSearchSubProblem`</span>

<span class="sd">        :param solver_name: External solver name</span>
<span class="sd">        :type solver_name: str</span>
<span class="sd">        :param exterior_point: Exterior point</span>
<span class="sd">        :type exterior_point: ndarray</span>
<span class="sd">        :param interior_point: Interior point</span>
<span class="sd">        :type interior_point: ndarray</span>
<span class="sd">        :return: value of parameter :math:`\\alpha` and solution point</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_search_sub_problem</span><span class="o">.</span><span class="n">set_interior_exterior_points</span><span class="p">(</span>
            <span class="n">exterior_point</span><span class="p">,</span> <span class="n">interior_point</span><span class="p">)</span>

        <span class="n">alpha</span><span class="p">,</span> <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_search_sub_problem</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">point</span></div>

<div class="viewcode-block" id="PyomoSubProblems.add_linear_constraint"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems.add_linear_constraint">[docs]</a>    <span class="k">def</span> <span class="nf">add_linear_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds linear constraints to sub-problems&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">add_linear_constraint</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proj_sub_problem</span><span class="o">.</span><span class="n">add_linear_constraint</span><span class="p">()</span></div>

<div class="viewcode-block" id="PyomoSubProblems.update_var_lower_bound"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems.update_var_lower_bound">[docs]</a>    <span class="k">def</span> <span class="nf">update_var_lower_bound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the lower bound of variable by index</span>

<span class="sd">        :param index: Index of the variable (block_id, index)</span>
<span class="sd">        :type index: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">update_var_lower_bound</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proj_sub_problem</span><span class="o">.</span><span class="n">update_var_lower_bound</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_search_sub_problem</span><span class="o">.</span><span class="n">update_var_lower_bound</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyomoSubProblems.update_var_upper_bound"><a class="viewcode-back" href="../../../sources/generated/decogo.pyomo_minlp_model.input_model.html#decogo.pyomo_minlp_model.input_model.PyomoSubProblems.update_var_upper_bound">[docs]</a>    <span class="k">def</span> <span class="nf">update_var_upper_bound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the upper bound of variable by index</span>

<span class="sd">        :param index: Index of the variable (block_id, index)</span>
<span class="sd">        :type index: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minlp_sub_problem</span><span class="o">.</span><span class="n">update_var_upper_bound</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proj_sub_problem</span><span class="o">.</span><span class="n">update_var_upper_bound</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_search_sub_problem</span><span class="o">.</span><span class="n">update_var_upper_bound</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Pavlo Muts, Ouyang Wu and Ivo Nowak.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>